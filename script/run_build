#!/bin/bash
# This file was generated on 2019-12-18T14:01:39+00:00 from the rspec-dev repo.
# DO NOT modify it by hand as your changes will get lost the next time it is generated.

set -e
source script/functions.sh

# Allow repos to override the default functions and add their own
if [ -f script/custom_build_functions.sh ]; then
  source script/custom_build_functions.sh
fi

fold "binstub check" check_binstubs

bin/rake clobber:app
bin/rake generate:app

bin/rake generate:stuff


mkdir -p tmp/example_app/spec/system/
tee -a tmp/example_app/spec/system/widget_system_spec.rb << END
require "rails_helper"
RSpec.describe "Widget management", :type => :system do
  before do
    driven_by(:selenium_chrome_headless)
  end
  it "enables me to create widgets" do
    visit "/widgets/new"
    fill_in "Name", :with => "My Widget"
    click_button "Create Widget"
    expect(page).to have_text("Widget was successfully created.")
  end
end
END

cd tmp/example_app/
bundle install
bundle exec rspec --backtrace spec/system/widget_system_spec.rb
echo $?

cd ../../

bin/cucumber features/system_specs/system_specs.feature
# echo $?

# fold "specs" run_specs_and_record_done

# if additional_specs_available; then
#   fold "additional specs" run_additional_specs
# fi

# fold "cukes" run_cukes

# if documentation_enforced; then
#   fold "doc check" check_documentation_coverage
# fi

# if style_and_lint_enforced; then
#   fold "rubocop" check_style_and_lint
# fi

# if is_mri; then
#   fold "one-by-one specs" run_specs_one_by_one
#   run_all_spec_suites
# else
#   echo "Skipping the rest of the build on non-MRI rubies"
# fi


echo "DONE"
